from __future__ import annotations

import argparse
from pathlib import Path

from app.rules.rule_engine import load_incident_json, render_report, save_text


def main() -> int:
    parser = argparse.ArgumentParser(
        description="KVKK Decision Engine - KVKK ihlal olayları için rapor taslağı üretir."
    )
    parser.add_argument(
        "-i", "--input",
        required=True,
        help="Olay dosyası (JSON). Örn: data/incident_examples.json"
    )
    parser.add_argument(
        "-o", "--output",
        default="out/report.md",
        help="Çıktı raporu (Markdown). Varsayılan: out/report.md"
    )
    args = parser.parse_args()

    incident = load_incident_json(args.input)
    report = render_report(incident)

    out_path = Path(args.output)
    save_text(str(out_path), report)

    print(f"OK: Rapor üretildi -> {out_path}")
    return 0


if __name__ == "__main__":
    raise SystemExit(main())
